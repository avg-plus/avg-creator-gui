import { BlockToolConstructorOptions } from "@editorjs/editorjs";
import { key } from "nconf";
import { CEPlugin } from "../ce-plugin";
import EL from "./vendor";

interface APISceneData {
  content: string;
}

export class APISceneTool extends CEPlugin<APISceneData> {
  constructor(options: BlockToolConstructorOptions<APISceneData>) {
    super(options);
  }

  static get toolbox() {
    return {
      title: "显示场景",
      icon: '<svg t="1627832918294" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7676" width="200" height="200"><path d="M446.1 891c-7.3 0-13.3-6-13.3-13.3V591.6c0-7.3 6-13.3 13.3-13.3h81.1c5.1-31.2 32.2-55 64.7-55 32.6 0 59.7 23.9 64.7 55h75.6c7.3 0 13.3 6 13.3 13.3v286.1c0 7.3-6 13.3-13.3 13.3H446.1z" fill="#E5F1F9" p-id="7677"></path><path d="M591.9 536.6c28.9 0 52.3 23.4 52.3 52.3 0 0.9-0.1 1.8-0.1 2.8h88.2v286.1H446.1V591.6h93.7c0-0.9-0.1-1.8-0.1-2.8-0.1-28.8 23.3-52.2 52.2-52.2m0-26.6c-35.2 0-65 23.1-75.2 55h-70.6c-14.7 0-26.6 11.9-26.6 26.6v286c0 14.7 11.9 26.6 26.6 26.6h286.1c14.7 0 26.6-11.9 26.6-26.6v-286c0-14.7-11.9-26.6-26.6-26.6h-65.1c-10.2-31.8-40-55-75.2-55z" fill="#282F63" p-id="7678"></path><path d="M712.2 591.6v266.1H446.1v20h286.1V591.6z" fill="#AAD4E9" p-id="7679"></path><path d="M138.1 891c-7.3 0-13.3-6-13.3-13.3V591.6c0-7.3 6-13.3 13.3-13.3h286.1c7.3 0 13.3 6 13.3 13.3v81.1c31.2 5.1 55 32.2 55 64.7 0 32.6-23.9 59.7-55 64.7v75.6c0 7.3-6 13.3-13.3 13.3H138.1z" fill="#1E62A1" p-id="7680"></path><path d="M424.1 591.6v93.7c0.9 0 1.8-0.1 2.8-0.1 28.9 0 52.3 23.4 52.3 52.3s-23.4 52.3-52.3 52.3c-0.9 0-1.8-0.1-2.8-0.1v88.2h-286V591.6h286m0-26.6h-286c-14.7 0-26.6 11.9-26.6 26.6v286.1c0 14.7 11.9 26.6 26.6 26.6h286.1c14.7 0 26.6-11.9 26.6-26.6v-65.1c31.9-10.1 55-40 55-75.2s-23.1-65-55-75.2v-70.6c-0.1-14.7-12-26.6-26.7-26.6z" fill="#282F63" p-id="7681"></path><path d="M164.7 611.6h259.4v-20h-286v286.1h26.6z" fill="#3381BC" p-id="7682"></path><path d="M278.3 637.9c-32.6 0-59.7-23.9-64.7-55H138c-7.3 0-13.3-6-13.3-13.3v-286c0-7.3 6-13.3 13.3-13.3h286.1c7.3 0 13.3 6 13.3 13.3v88.2c0 3.6-1.5 7.1-4.1 9.6-2.5 2.4-5.8 3.7-9.2 3.7h-0.6c-0.4 0-0.8 0-1.2-0.1h-0.9c-24.5 0-44.5 19.9-44.5 44.5s19.9 44.5 44.5 44.5h0.9c0.4 0 0.8-0.1 1.3-0.1h0.6c3.4 0 6.7 1.3 9.2 3.7 2.6 2.5 4.1 6 4.1 9.6v82.7c0 7.3-6 13.3-13.3 13.3H343c-5 30.9-32.1 54.7-64.7 54.7z" fill="#E5F1F9" p-id="7683"></path><path d="M424.1 283.6v88.2c-0.9 0-1.8-0.1-2.8-0.1-31.9 0-57.8 25.9-57.8 57.8s25.9 57.8 57.8 57.8c0.9 0 1.8-0.1 2.8-0.1v82.7h-93.7c0 0.9 0.1 1.8 0.1 2.8 0 28.9-23.4 52.3-52.3 52.3s-52.3-23.4-52.3-52.3c0-0.9 0.1-1.8 0.1-2.8h-88.2V283.6h286.3m0-26.6h-286c-14.7 0-26.6 11.9-26.6 26.6v286.1c0 14.7 11.9 26.6 26.6 26.6h65.1c10.1 31.9 40 55 75.2 55s65-23.1 75.2-55h70.6c14.7 0 26.6-11.9 26.6-26.6V487c0-7.3-3-14.2-8.2-19.2-5-4.7-11.5-7.4-18.4-7.4h-1.3c-0.5 0-1 0.1-1.5 0.1h-0.3c-17.1-0.1-30.9-14.1-30.9-31.2s13.8-31 30.9-31.2h0.3c0.5 0 1 0.1 1.5 0.1h1.3c6.8 0 13.4-2.6 18.4-7.4 5.3-5 8.2-12 8.2-19.2v-88c-0.1-14.7-12-26.6-26.7-26.6z" fill="#282F63" p-id="7684"></path><path d="M164.7 310.2h259.4v-26.6h-286v286h26.6z" fill="#FFFFFF" p-id="7685"></path><path d="M700.4 532.1c-3.4 0-6.6-1.3-9.1-3.6L627 468.2c-2.7-2.5-4.2-6-4.2-9.6 0-3.6 1.4-7.1 4-9.7 0.3-0.3 0.6-0.6 0.9-0.8l0.6-0.6c8.1-8.7 12.4-20 12-31.8s-5.4-22.9-14-31c-8.3-7.8-19.1-12-30.4-12-12.4 0-23.9 5-32.4 14-0.2 0.2-0.4 0.4-0.6 0.7-0.3 0.3-0.5 0.6-0.8 1-2.4 2.8-5.8 4.4-9.4 4.6h-0.7c-3.4 0-6.6-1.3-9.1-3.6l-60.3-56.6c-5.4-5-5.6-13.4-0.6-18.8l55.5-59.1c-8.4-10.8-13.1-24-13.5-37.9-0.6-17.5 5.7-34.2 17.7-46.9 12.3-13.2 29.8-20.7 47.8-20.7 13.2 0 25.8 3.9 36.6 11.1l51.7-55.1c2.6-2.8 6.2-4.2 9.7-4.2 3.3 0 6.5 1.2 9.1 3.6l208.6 195.7c2.6 2.4 4.1 5.8 4.2 9.3 0.1 3.5-1.2 7-3.6 9.5L710.1 527.9c-2.4 2.6-5.8 4.1-9.3 4.2h-0.4z" fill="#FFDBA0" p-id="7686"></path><path d="M687.6 114.4l208.6 195.7-195.8 208.7-54.3-50.9-10-9.4c0.7-0.6 1.3-1.2 2-1.9 21.8-23.3 20.7-59.8-2.6-81.6-11.1-10.5-25.3-15.6-39.5-15.6-15.4 0-30.8 6.1-42.1 18.2l-1.8 2.1-6-5.6-54.3-51.1 64.1-68.3c-0.7-0.6-1.4-1.1-2.1-1.8-21-19.7-22.1-52.8-2.3-73.9 10.3-11 24.2-16.5 38.1-16.5 12.8 0 25.7 4.7 35.7 14.2 0.7 0.6 1.3 1.3 1.9 2l60.4-64.3m0-26.6h-0.8c-7.1 0.2-13.7 3.2-18.6 8.4l-44.5 47.5c-10.5-5-22.1-7.7-34-7.7-21.7 0-42.7 9.1-57.5 24.9-24.1 25.6-27.6 63.3-11.3 92.5l-48.3 51.5c-4.8 5.1-7.4 12-7.2 19 0.2 7.1 3.2 13.7 8.4 18.6l54.3 50.9 6 5.6c4.9 4.6 11.5 7.2 18.2 7.2h1.5c7.3-0.4 14-3.8 18.8-9.3 0.3-0.4 0.6-0.8 1-1.2l0.2-0.2c5.9-6.2 13.9-9.6 22.5-9.6 7.9 0 15.5 3 21.3 8.4 6.1 5.7 9.6 13.4 9.8 21.7 0.3 8.2-2.7 16.1-8.2 22.1l-0.2 0.2c-0.4 0.3-0.7 0.7-1.1 1-5.2 5.1-8.1 12-8.1 19.3 0.1 7.3 3.1 14.2 8.4 19.2l10 9.4 54.3 50.9c4.9 4.6 11.5 7.2 18.2 7.2h0.8c7.1-0.2 13.7-3.2 18.6-8.4l195.7-208.6c10.1-10.7 9.5-27.5-1.2-37.6L705.8 95c-5-4.6-11.5-7.2-18.2-7.2z" fill="#282F63" p-id="7687"></path><path d="M687.6 114.4l-9.2 9.8 191.2 179.3L683 502.4l17.4 16.4 195.8-208.6z" fill="#FCC975" p-id="7688"></path><path d="M448.6 143.6c-4.6 0-8.3-3.7-8.3-8.3 0-7.7-5.6-14.6-13.2-15.3-8.6-0.8-16 6-16 14.5v0.8c0 4.6-3.7 8.3-8.3 8.3-7.7 0-14.6 5.6-15.3 13.2-0.8 8.6 6 16 14.5 16h0.8c4.6 0 8.3 3.7 8.3 8.3 0 7.7 5.6 14.6 13.2 15.3 8.6 0.8 16-6 16-14.5v-0.8c0-4.6 3.7-8.3 8.3-8.3h0.8c8.5 0 15.3-7.3 14.5-16-0.8-7.6-7.7-13.2-15.3-13.2zM867.5 542.6c-4.6 0-8.3-3.7-8.3-8.3 0-7.7-5.6-14.6-13.2-15.3-8.6-0.8-16 6-16 14.5v0.8c0 4.6-3.7 8.3-8.3 8.3-7.7 0-14.6 5.6-15.3 13.2-0.8 8.6 6 16 14.5 16h0.8c4.6 0 8.3 3.7 8.3 8.3 0 7.7 5.6 14.6 13.2 15.3 8.6 0.8 16-6 16-14.5v-0.8c0-4.6 3.7-8.3 8.3-8.3h0.8c8.5 0 15.3-7.3 14.5-16-0.7-7.6-7.6-13.2-15.3-13.2z" fill="#9AD6E8" p-id="7689"></path></svg>'
    };
  }

  render() {
    return EL.render("", {
      target: this,
      events: {
        onKeyUp: this.onKeyUp,
        onKeyDown: this.onKeyDown
      }
    });
  }

  onKeyDown(e: KeyboardEvent): void {
    if (e.metaKey && e.key === "a") {
      EL.selectAll();
      return;
    }

    if (e.key === "ArrowUp") {
      e.preventDefault();
      this.options.api.caret.setToPreviousBlock("default");
    } else if (e.key === "ArrowDown") {
      e.preventDefault();
      this.options.api.caret.setToNextBlock("default");
    }
  }

  onKeyUp(e: KeyboardEvent) {}

  save(blockContent) {
    return {
      url: blockContent.value
    };
  }
}
